- debug:
    var: hsflowd_collectors|length
- name: Assert minimal hsflowd config
  assert:
    that: hsflowd_collectors|length >= 1
    msg: "At least one collector must be defined."

- name: Install hsflowd with yum
  yum:
    name: "{{ hsflowd_url | default( hsflowd_package_name ) }}"
    state: present
  when: ansible_os_family == "RedHat"

- name: Install hsflowd with apt
  apt:
    deb: "{{ hsflowd_url | default( hsflowd_package_name ) }}"
  when: ansible_os_family == "Debian"

- name: Template hsflowd.conf
  template:
    src: "hsflowd.conf.j2"
    dest: /etc/hsflowd.conf
  notify: restart hsflowd

- name: Enable/start hsflowd service
  service:
    name: hsflowd
    state: started
    enabled: yes
